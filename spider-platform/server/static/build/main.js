webpackJsonp([1],{0:function(e,t,r){"use strict";var n=r(4),a=r(463),o=a.Route,s=a.RouteHandler,l=(a.Link,a.DefaultRoute),c=a.NotFoundRoute,i=r(505),u=i.IndexPage,d=r(509),m=d.JobPage,p=n.createClass({displayName:"NotFound",render:function(){return n.createElement("div",null,n.createElement("h2",null,"404 找不到网页"),n.createElement("p",null,"您试图访问的页面不存在."))}}),h=n.createClass({displayName:"App",render:function(){return n.createElement(s,null)}}),E=n.createElement(o,{path:"/",handler:h},n.createElement(l,{handler:u,name:"index"}),n.createElement(o,{path:"job/:id",handler:m,name:"job"}),n.createElement(c,{handler:p}));a.run(E,a.HashLocation,function(e){n.render(n.createElement(e,null),document.getElementById("root"))})},505:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),a=r(180),o=a.Panel,s=r(506),l=s.JobList,c=r(508),i=c.AggregateJobStats,u=r(454),d=u.ProcessStatsTable,m=n.createClass({displayName:"IndexPage",render:function(){return n.createElement("div",{className:"row"},n.createElement("div",{className:"col-lg-7 col-md-7"},n.createElement(o,{collapsible:!0,defaultExpanded:!0,header:"任务",bsStyle:"primary"},n.createElement(l,null)),n.createElement(o,{collapsible:!0,defaultExpanded:!0,header:"系统状态",className:"hidden-lg"},n.createElement(d,null))),n.createElement("div",{className:"col-lg-5 col-md-5"},n.createElement(o,{collapsible:!0,defaultExpanded:!0,header:"系统状态",className:"visible-lg-block"},n.createElement(d,null)),n.createElement(o,{collapsible:!0,defaultExpanded:!0,header:"爬虫状态"},n.createElement(i,null))))}});t.IndexPage=m},506:function(e,t,r){"use strict";function n(e){for(var t=0;t<w.length;t++){var r=c(w[t],2),n=r[0],a=r[1];if(n.test(e))return a}return e}function a(e){var e=n(e);return"crawling"==e?{pause:!0,stop:!0}:"suspended"==e?{resume:!0,stop:!0}:{}}function o(e){var t=e.stats.item_scraped_count||0,r=Math.round(60*e.itemsSpeed);return t+" @ "+r+"/min"}function s(e,t){var r=e.stats||{},a=n(e.status),o=r["downloader/response_bytes"]||0,s=e.id;e.job_id&&(s=s+": "+e.job_id.slice(-5));var l=0;if(r.start_time){var c=P(r.start_time);if(r.finish_time)var i=P(r.finish_time);else var i=t||new Date;l=i.getTime()-c.getTime()}var u=l/1e3,d=l?o/u:0,m=l?(r.item_scraped_count||0)/u:0;return{id:e.job_id||e.id,status:a,rowClass:N[a]||"",stats:r,downloaded:o,downloadSpeed:d,itemsSpeed:m,todo:(r["scheduler/enqueued"]||0)-(r["scheduler/dequeued"]||0),shortId:s,duration:l}}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.buttonsForStatus=a;var i=r(4),u=r(160),d=r(455),m=r(456),p=r(463),h=(p.Link,p.Navigation),E=r(180),b=E.Table,f=E.Glyphicon,y=(E.Button,r(451)),v=r(507),_=v.JobsMixin,g=r(461);r(261);var N={crawling:"success",stopping:"info",suspended:"warning",done:""},w=[[/closespider/,"closed"]],k=i.createClass({displayName:"NoJobs",render:function(){return i.createElement("div",null,i.createElement("p",null,"没有任务运行."),i.createElement("p",null,'请通过"新增任务"或"读取配置"开始采集.'))}}),j=i.createClass({displayName:"GlyphA",render:function(){var e=this.props.button?" "+this.props.title:"";return i.createElement("a",l({href:"#"},this.props),i.createElement(f,{glyph:this.props.glyph}),e)}}),C=i.createClass({displayName:"JobStopButton",render:function(){return i.createElement(j,{title:"Stop",glyph:"stop",onClick:this.onClick,button:this.props.button,className:this.props.className})},onClick:function(e){e.preventDefault();var t=this.props.job.id;confirm("Stop job #"+t+"?")&&y.Actions.stopCrawl(t)}});t.JobStopButton=C;var J=i.createClass({displayName:"JobPauseButton",render:function(){return i.createElement(j,{title:"Pause",glyph:"pause",onClick:this.onClick,button:this.props.button,className:this.props.className})},onClick:function(e){e.preventDefault(),y.Actions.pauseCrawl(this.props.job.id)}});t.JobPauseButton=J;var S=i.createClass({displayName:"JobResumeButton",render:function(){return i.createElement(j,{title:"Resume",glyph:"play",onClick:this.onClick,button:this.props.button,className:this.props.className})},onClick:function(e){e.preventDefault(),y.Actions.resumeCrawl(this.props.job.id)}});t.JobResumeButton=S;var T=i.createClass({displayName:"JobControlIcons",render:function(){var e=this.props.job,t=a(e.status),r={job:e},n=[];return t.pause&&n.push(i.createElement("span",{key:"pause"},i.createElement(J,r),"  ")),t.resume&&n.push(i.createElement("span",{key:"resume"},i.createElement(S,r),"  ")),t.stop&&n.push(i.createElement(C,l({key:"stop"},r))),i.createElement("span",null,n)}});t.JobControlIcons=T;var x=i.createClass({displayName:"JobControlButtons",render:function(){var e=this.props.job,t=a(e.status),r={button:!0,job:e},n=[];return t.pause&&n.push(i.createElement("span",{key:"pause"},i.createElement(J,l({className:"btn"},r)),"  ")),t.resume&&n.push(i.createElement("span",{key:"resume"},i.createElement(S,l({className:"btn"},r)),"  ")),t.stop&&n.push(i.createElement(C,l({key:"stop",className:"btn"},r))),i.createElement("span",null,n)}});t.JobControlButtons=x;var P=function(e){var e=e.replace(" ","T");return new Date(e+"Z")},A=i.createClass({displayName:"JobRow",mixins:[h],render:function(){var e=this,t=this.props.job,r=s(t,this.props.serverTime),n={cursor:"pointer"},a=function(){e.transitionTo("job",{id:t.id})},l=[i.createElement("td",{key:"col-buttons"},i.createElement(T,{job:t})),i.createElement("th",{key:"col-id",scope:"row",style:n,onClick:a},r.shortId)],c=[t.seed,r.status,o(r),d(r.downloaded),m(r.duration)];return l=l.concat(c.map(function(e,t){return i.createElement("td",{style:n,onClick:a,key:t},e)})),i.createElement("tr",{className:r.rowClass},l)}}),R=i.createClass({displayName:"JobRowVerbose",mixins:[h],render:function(){var e=this.props.job,t=s(e,this.props.serverTime),r=[i.createElement("th",{key:"col-id",scope:"row"},t.id)],n=[e.seed,t.stats.start_time,t.status,o(t),t.todo,d(t.downloaded),d(t.downloadSpeed,{round:1})+"/s",m(t.duration)];return r=r.concat(n.map(function(e,t){return i.createElement("td",{key:t},e)})),i.createElement("tr",{className:t.rowClass},r)}}),q=i.createClass({displayName:"JobListWidget",mixins:[u.connect(g.store,"stats")],render:function(){var e=this.state.stats,t=this.props.jobs.map(function(t){return i.createElement(A,{job:t,key:t.id,serverTime:e.serverTime})});return i.createElement(b,{fill:!0,hover:this.props.link},i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",{key:"col-buttons"}),i.createElement("th",{key:"col-id"},"ID"),i.createElement("th",{key:"col-seed"},"主域名"),i.createElement("th",{key:"col-status"},"状态"),i.createElement("th",{key:"col-items"},"速率"),i.createElement("th",{key:"col-data",className:"col-md-2"},"数据量"),i.createElement("th",{key:"col-runtime",className:"col-md-2"},"用时"))),i.createElement("tbody",null,t))}});t.JobListWidget=q;var I=i.createClass({displayName:"JobListWidgetVerbose",mixins:[u.connect(g.store,"stats")],render:function(){var e=this.state.stats,t=this.props.jobs.map(function(t){return i.createElement(R,{job:t,key:t.id,serverTime:e.serverTime})});return i.createElement(b,{fill:!0},i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",{key:"col-id"},"ID"),i.createElement("th",{key:"col-seed"},"主域名"),i.createElement("th",{key:"col-started"},"开始时间"),i.createElement("th",{key:"col-status"},"状态"),i.createElement("th",{key:"col-items"},"速率"),i.createElement("th",{key:"col-queue"},"待请求"),i.createElement("th",{key:"col-data",className:"col-md-1"},"数据量"),i.createElement("th",{key:"col-speed",className:"col-md-1"},"↓ 网速"),i.createElement("th",{key:"col-runtime"},"用时"))),i.createElement("tbody",null,t))}});t.JobListWidgetVerbose=I;var O=i.createClass({displayName:"JobList",mixins:[_],render:function(){var e=this.state.jobs;return e.length?i.createElement(q,{jobs:e}):i.createElement(k,null)}});t.JobList=O},507:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(r(4),r(160)),a=r(451),o=n.connect(a.store,"jobs");t.JobsMixin=o},508:function(e,t,r){"use strict";function n(e){return Object.keys(e).map(function(t){var r=e[t];if(0==r)return"";/_bytes$|memusage/.test(t)&&(r=o(r));var n=E[t]||t;return a.createElement("tr",{key:t},a.createElement("td",null,n),a.createElement("td",null,r))}).filter(function(e){return""!=e})}Object.defineProperty(t,"__esModule",{value:!0});var a=r(4),o=(r(160),r(455)),s=r(180),l=(s.Table,r(462)),c=l.KeyValueTable,i=(r(451),r(507)),u=i.JobsMixin,d=function(e){return Array.from(new Array(e),function(e,t){return t})},m=[200,201,202,203,204,205,206,207,226,300,301,302,303,304,305,306,307,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,422,423,424,425,426,428,429,431,434,449,451,456,499,500,501,502,503,504,505,506,507,508,509,510,511].map(function(e){return"downloader/response_status_count/"+e}),p=d(20).map(function(e){return"request_depth_count/"+e}),h=["downloader/request_bytes","downloader/request_count","downloader/request_method_count/GET","downloader/request_method_count/POST","downloader/request_method_count/PUT","downloader/request_method_count/HEAD","downloader/request_method_count/DELETE","downloader/request_method_count/TRACE","downloader/request_method_count/CONNECT","downloader/request_method_count/OPTIONS","downloader/response_bytes","downloader/response_count"].concat(m).concat(["downloader/exception_count","downloader/exception_type_count/twisted.internet.error.DNSLookupError","downloader/exception_type_count/twisted.internet.error.ConnectionRefusedError","dupefilter/filtered","item_scraped_count","log_count/DEBUG","log_count/INFO","log_count/WARNING","log_count/ERROR","response_received_count","scheduler/dequeued","scheduler/dequeued/memory","scheduler/enqueued","scheduler/enqueued/memory"]).concat(p).concat(["spider_exceptions/AttributeError","spider_exceptions/ValueError","spider_exceptions/TypeError"]).concat(["motor/items_stored_count","motor/store_error_count","motor/store_error_count/AutoReconnect"]),E={"downloader/exception_type_count/twisted.internet.error.DNSLookupError":"downloader/DNS errors","downloader/exception_type_count/twisted.internet.error.ConnectionRefusedError":"downloader/Connection Refused"},b=a.createClass({displayName:"AggregateJobStats",mixins:[u],render:function(){var e=this.getAggregateStats(this.state.jobs),t=n(e);return 0==t.length?a.createElement("p",null,"This panel displays various crawl stats. Nothing to show yet."):a.createElement(c,{noheader:this.props.fill},t)},getAggregateStats:function(e){var t={};return h.forEach(function(e){t[e]=0}),e.forEach(function(e){h.forEach(function(r){t[r]+=e.stats[r]||0})}),t}});t.AggregateJobStats=b;var f=a.createClass({displayName:"JobStats",render:function(){var e=this.props.job.stats,t={};Object.keys(e).sort().forEach(function(r){t[r]=e[r]});var r=n(t);return 0==r.length?a.createElement("p",null,"Nothing to show yet."):a.createElement(c,{noheader:this.props.fill},r)}});t.JobStats=f},509:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),a=r(160),o=r(463),s=o.Link,l=r(180),c=l.Panel,i=l.Table,u=(l.Button,l.Glyphicon),d=(l.ButtonToolbar,r(451)),m=r(454),p=(m.ProcessStatsTable,r(508)),h=p.JobStats,E=r(506),b=E.JobListWidgetVerbose,f=E.JobControlButtons,y=r(510),v=y.ShortTermQueueWidget,_=n.createClass({displayName:"ShortJobInfo",render:function(){var e=this.props.job,t=[e];return n.createElement(b,{jobs:t})}}),g=(n.createClass({displayName:"JobInfo",render:function(){var e=this.props.job,t=[["Target",e.seed],["Status",e.status],["Job ID",e.id],["Started at",e.stats.start_time]];e.stats.finish_time&&t.push(["Finished at",e.stats.finish_time]);var r=t.map(function(e){return n.createElement("tr",{key:e[0]},n.createElement("td",null,e[0]),n.createElement("td",null,e[1]))});return n.createElement("div",null,n.createElement(i,null,n.createElement("caption",null,"General Job Information"),n.createElement("tbody",null,r)))}}),n.createClass({displayName:"NoJobPage",render:function(){return n.createElement("div",null,n.createElement("h2",null,"Job is not found"),n.createElement("p",null,"This job is either not available or never existed."),n.createElement(s,{to:"index"},n.createElement(u,{glyph:"menu-left"}),"  Back to Full Job List"))}})),N=n.createClass({displayName:"JobPage",mixins:[a.connectFilter(d.store,"job",function(e){var t=this;return e.filter(function(e){return e.id==t.props.params.id})[0]})],render:function(){var e=this.state.job;return e?n.createElement("div",{className:"row"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col-lg-12"},n.createElement(s,{to:"index",className:"btn"},n.createElement(u,{glyph:"menu-left"})," 全部任务"),"  ",n.createElement(f,{job:e}),n.createElement("br",null),n.createElement("br",null),n.createElement(_,{job:e}))),n.createElement("div",{className:"row"},n.createElement("div",{className:"col-lg-5"},n.createElement(c,{collapsible:!0,defaultExpanded:!0,header:"爬虫统计"},n.createElement(h,{job:e}))),n.createElement("div",{className:"col-lg-7"},n.createElement(c,{collapsible:!0,defaultExpanded:!0,header:"请求队列"},n.createElement(v,{job:e}))))):n.createElement(g,null)}});t.JobPage=N},510:function(e,t,r){"use strict";function n(e,t){var r=new Date,n={};return e.forEach(function(e){n[e]=r}),Object.keys(t).filter(function(e){return n[e]}).forEach(function(e){n[e]=t[e]}),n}function a(e,t){var r=e.slice();return r.sort(function(e,r){return t[e.url]-t[r.url]}),r}Object.defineProperty(t,"__esModule",{value:!0});var o=r(511),s=(r(160),r(455),r(456)),l=r(180),c=l.Table,i=(r(451),r(507)),u=(i.JobsMixin,o.createClass({displayName:"ShortTermQueueWidget",propTypes:{job:o.PropTypes.object.isRequired},getInitialState:function(){return{seenAt:{}}},componentWillReceiveProps:function(e){var t=e.job.downloads.active.map(function(e){return e.url});this.setState({seenAt:n(t,this.state.seenAt)})},render:function(){var e=this,t=this.props.job.downloads,r=a(t.active,this.state.seenAt);if(!r.length)return!1;var n=function(t){var r=a(t.active,e.state.seenAt),n={};t.transferring.forEach(function(e){return n[e.url]=!0});var l=r.map(function(e){var t=n[e.url]?"success":"default";return o.createElement("tr",{key:e.url,className:t},o.createElement("td",null,e.url))}),i=s(1e3*(t.delay||0));return o.createElement(c,{key:t.key},o.createElement("caption",null,t.key,"  ",o.createElement("span",{className:"pull-right"},"download delay: ",i)),o.createElement("tbody",null,l))},l=t.slots.map(function(e){return n(e)});return o.createElement("div",null,l)}}));t.ShortTermQueueWidget=u}});